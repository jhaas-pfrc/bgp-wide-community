<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE rfc PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/rfc2629.dtd"[
  <!ENTITY RFC1997 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1997.xml">
  <!ENTITY RFC2119 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
  <!ENTITY RFC2629 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2629.xml">
  <!ENTITY RFC3552 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3552.xml">
  <!ENTITY RFC3629 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3629.xml">
  <!ENTITY RFC3640 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3640.xml">
  <!ENTITY RFC4271 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
  <!ENTITY RFC4360 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4360.xml">
  <!ENTITY RFC4893 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4893.xml">
  <!ENTITY RFC5668 PUBLIC '' "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5668.xml">
  <!ENTITY as4octet-generic PUBLIC '' "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-idr-as4octet-extcomm-generic-subtype-06.xml">
  <!ENTITY error-handling PUBLIC '' "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-idr-error-handling-05.xml">
  <!ENTITY ieee-float PUBLIC '' "http://xml.resource.org/public/rfc/bibxml2/reference.IEEE.754.1985.xml">
]>
<?xml-stylesheet type='text/xsl'
href="http://greenbytes.de/tech/webdav/rfc2629xslt/rfc2629.xslt" ?>
<?rfc strict="no" ?>
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="std"
     docName="draft-raszuk-wide-bgp-communities-04"
     ipr="trust200902"
     obsoletes=""
     updates=""
     submissionType="IETF"
     xml:lang="en">
  <!-- category values: std, bcp, info, exp, and historic
     ipr values: full3667, noModification3667, noDerivatives3667
     you can add the attributes updates="NNNN" and obsoletes="NNNN"
     they will automatically be output with "(if approved)" -->
  <!-- ***** FRONT MATTER ***** -->

<front>

<title abbrev="wide-bgp-communities">
Wide BGP Communities Attribute
</title>

<author initials="R" surname="Raszuk" fullname="Robert Raszuk"
role="editor">
        <organization> </organization>
        <address>
                <postal>
                <street> </street>
                <city> </city>
                <region> </region>
                <code> </code>
                <country> </country>
                </postal>
                <email>robert@raszuk.net</email>
        </address>
</author>

<author initials="J" surname="Haas" fullname="Jeffrey Haas" role="editor">
	<organization>Juniper Networks</organization>
	<address>
		<postal>
		<street>1194 N.Mathilda Ave</street>
		<city>Sunnyvale</city>
		<region>CA</region>
		<code>94089</code>
		<country>US</country>
		</postal>
		<email>jhaas@juniper.net</email>
	</address>
</author>

<author initials="A" surname="Lange" fullname="Andrew Lange" role="editor">
	<organization>Alcatel-Lucent</organization>
	<address>
		<postal>
		<street></street>
		<city></city>
		<region></region>
		<code></code>
		<country></country>
		</postal>
		<email>andrew.lange@alcatel-lucent.com</email>
	</address>
</author>

<author initials="S" surname="Amante" fullname="Shane Amante">
	<organization>Apple, Inc.</organization>
	<address>
		<postal>
		<street>1 Infinite Loop</street>
		<city>Cupertino</city>
		<region>CA</region>
		<code>95014</code>
		<country>US</country>
		</postal>
		<email>amante@apple.com</email>
	</address>
</author>

<author initials="R" surname="Steenbergen" fullname="Richard A Steenbergen">
	<organization>nLayer Communications, Inc.</organization>
	<address>
		<postal>
		<street>209 W Jackson Blvd</street>
		<city>Chicago</city>
		<region>IL</region>
		<code>60606</code>
		<country>US</country>
		</postal>
		<email>ras@nlayer.net</email>
	</address>
</author>

<author initials="B" surname="Decraene" fullname="Bruno Decraene">
	<organization>France Telecom</organization>
	<address>
		<postal>
		<street>38-40 rue du General Leclerc</street>
		<city>Issi Moulineaux cedex 9</city>
		<code>92794</code>
		<country>France</country>
		</postal>
		<email>bruno.decraene@orange-ftgroup.com</email>
	</address>
</author>

<author initials="P" surname="Jakma" fullname="Paul Jakma">
	<organization abbrev="Uni. of Glasgow">
	               University of Glasgow</organization>
	<address>
		<postal>
		<street>School of Computing Science</street>
		<street>Sir Alwyn Williams Building</street>
		<street>University of Glasgow</street>
		<city>Glasgow</city>
		<code>G12 8QQ</code>
		<country>UK</country>
		</postal>
		<email>paulj@dcs.gla.ac.uk</email>
	</address>
</author>

<date month="February" year="2014" />
<area>Routing</area>
<workgroup>IDR Working Group</workgroup>
<keyword>I-D</keyword>
<keyword>Internet-Draft</keyword>
<keyword>IDR</keyword>

<abstract>

<t>Route tagging plays an important role in external
<xref target="RFC4271">BGP</xref> relations,
in communicating various routing policies between peers. It
is also a very common best practice among operators to propagate
various additional information about routes intra-domain. The
most common tool used today to attach various information about
routes is through the use of
<xref target="RFC1997">BGP communities</xref>.</t>

<t>Such information is important to allow BGP speakers to
perform some mutually agreed upon actions without the need to
maintain a separate offline database for each tuple of prefix
and associated set of action entries.</t>

<t>This document defines a new encoding which will enhance
and simplify what can be accomplished today with the use of
BGP communities. The most important addition this specification
makes over currently defined BGP communities is the ability to
specify, carry as well as use for execution an operator's defined
set of parameters. It also provides an extensible platform
for any new community encoding needs in the future.</t>

</abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>

</front>

<middle>

<section title="Introduction">

<t><xref target="RFC1997">RFC 1997</xref> defines the BGP
Community Attribute.  This attribute is used as a tool to
carry additional information in BGP routes
which may help to automate peering administration.
The BGP Communities
Attribute consists of one or more sets of four octet values,
where each specifies a different community. Except for
two reserved ranges, the encoding of community values mandates
that the first two octets are to contain the Autonomous System
number, with the next two octets containing some locally defined
value.</t>

<t> With the introduction of 4-octet Autonomous System numbers
by <xref target="RFC4893">RFC 4893</xref> it became obvious
that BGP Communities as specified in RFC 1997 will not be able
to accommodate new AS encoding. In fact RFC 4893 explicitly
recommends use of
<xref target="RFC5668">four octets AS specific</xref>
<xref target="RFC4360">extended communities</xref>
as a way to encode new 4 octet AS numbers.</t>

<t> While the encoding of 4 octet AS numbers is being addressed
by <xref target="I-D.ietf-idr-as4octet-extcomm-generic-subtype"/>, neither the
base BGP communities (standard or extended) nor
as4octet-extcomm-generic document define a sufficient level of
encoding freedom which could be of practical use. The authors
believe that defining a new BGP Path Attribute, with the ability
to contain locally defined parameters will
enhance the current level of network policies, as well as simplify
BGP policy management. The proposed simple encoding will also
facilitate the delivery of new network services without a
need to define a new BGP extension each time.</t>

<t>When defining any new type of tool there is always a
unique opportunity to specify a subset of well recognized
behaviors. Lists of the current most commonly used BGP communities,
as well as provision for a new registry for future definitions
will be contained in a separate document.</t>

</section>


<section title="Wide Community Atoms">

<t>Wide BGP communities will act on and hence need to encode some distinct
atoms of data.  These are encoded as TLVs, where each TLV has the
following format:</t>

<figure>
<preamble></preamble>
<artwork align='center'>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+
|     Type      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Value (variable)                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
<postamble></postamble>
</figure>

<t>The Type field contains a value of 1-254.  The values 0 and 255 are
reserved for future use. The sub-TLV types are to be assigned and maintained by
IANA registry.</t>

<t>The Length represents the total length of a given sub-TLV
in octets.</t>

<t>The Value field contains the sub-TLV value.</t>

<t>Atoms of a given type may be present as either a singleton type or as a list
type.  This distinction is important for Wide Community Parameters, which may
potentially accept either one or a list of a given type of atom.  In cases
where sets of a given type are expected, the list type SHOULD be used for
compactness of expression; however, multiple occurrences of the same singleton
type will have the same semantics.</t>

<t>Supported format of the sub-TLVs can be:</t>

<figure><artwork>
  Type  1: Autonomous System number
  Type  2: Autonomous System number list
  Type  3: IPv4 prefix (1 octet prefix length + prefix)
  Type  4: IPv4 prefix (1 octet prefix length + prefix) list
  Type  5: IPv6 prefix (1 octet prefix length + prefix)
  Type  6: IPv6 prefix (1 octet prefix length + prefix) list
  Type  7: Integer
  Type  8: Integer list
  Type  9: IEEE Floating Point Number
  Type 10: IEEE Floating Point Number list
  Type 11: Neighbor Class
  Type 12: Neighbor Class list
  Type 13: User-defined Class
  Type 14: User-defined Class list
  Type 15: UTF-8 String
</artwork></figure>

<t>The semantics of a given atom will depend on the context it is used as
defined by the containing wide community.</t>

<t>In the following sections defining the different atoms, validation rules for
the Length of the atom will be presented.  If the Length of the atom does not
match the rules for that atom, it SHALL be considered malformed.</t>

<section title="The Autonomous System number atom">

<t>This atom represents an Autonomous System number, 4 octets in
size.  The Length of this atom is exactly 7 octets in size.</t>

<t>For consistent treatment, all AS numbers MUST be encoded as 4 octet
values.  When encoding two octet ASes, the first two octets of this four octet
value MUST be filled with zeros.</t>

<t>Two special values are reserved for the Autonomous
System atoms:</t>
<figure><artwork>
  0x00000000 - to indicate "No Autonomous Systems".
  0xFFFFFFFF - to indicate "All Autonomous Systems".
</artwork></figure>

</section>

<section title="The Autonomous System number list atom">

<t>This atom represents a list of Autonomous System numbers, each 4 octets in
size.  The minimum Length of this atom is 7 octets.  The Length of this atom
must be able to be represented by the relationship (Length - 3) % 4 = 0.</t>

</section>

<section title="The IPv4 and IPv6 prefix atoms">

<t>This atom represents an IPv4 or IPv6 prefix. IPv4 and IPv6 prefix atom
values are encoded in the same format used by BGP NLRI in Section
4.3 of <xref target="RFC4271"/>.
</t>

<figure><artwork>
+---------------------------+
|  Prefix Length (1 octet)  |
+---------------------------+
|  Prefix (variable)        |
+---------------------------+
</artwork>
</figure>

<t>The Prefix Length for IPv4 prefixes must be in the range of 0..32.</t>
<t>The Prefix Length for IPv6 prefixes must be in the range of 0..128.</t>

<t>The minimum Length of the prefix atoms is 4, which permits the default IPv4
or IPv6 prefix.</t>

</section>

<section title="The IPv4 and IPv6 prefix list atoms">

<t>This atom represents a list of prefixes, either IPv4 or IPv6 encoded as
above.</t>

<t>The Length field must be able to accommodate the list of
prefixes according to the encoding rules.  If the Length cannot fully
accommodate the required number of octets to encode the Prefix Length and the
Prefix, the atom is considered malformed.</t>

</section>

<section title="The Integer atom">
<t>This atom represents an Integer. Integers are a fixed Length of 4
octets and are stored in network byte order.</t>

<t>The Length of this atom is exactly 7 octets in size.</t>
</section>

<section title="The Integer list atom">
<t>This atom represents a list of Integers.</t>

<t>The minimum Length of the Integer list atom is 7 octets.  The Length of this
atom must be able to be represented by the relationship (Length - 3) % 4 =
0.</t>
</section>

<section title="The IEEE Floating Point Number atom">
<t>This atom represents a floating point number.  Floating point
numbers are a fixed Length of 4 octets and are stored in
<xref target="IEEE.754.1985"/> format.</t>

<t>The Length of this atom is exactly 7 octets in size.</t>

</section>

<section title="The IEEE Floating Point Number list atom">
<t>This atom represents a list of floating point numbers.</t>

<t>The minimum Length of the Floating Point Number list atom is 7 octets.  The
Length of this atom must be able to be represented by the relationship 
(Length - 3) % 4 = 0.</t>

</section>

<section title="The Neighbor Class atom">

<t>The Neighbor Class atom represents a classification of a BGP peering
session, each 2 octets in size.  This class currently can contain three values:</t>

<figure><artwork>
  1 - Peer:     This class is typically applied to sessions where a 
                transit-free relationship exists between two 
                providers.
  2 - Customer: This class is typically applied to sessions where 
                the remote end of the session is operated by a 
                customer.
  3 - Upstream: This class is typically applied to sessions where the 
                remote end of the session is operated by a network 
                from which you receive transit routes.
</artwork></figure>

<t>The Length of this atom is exactly 5 octets.</t>

</section>


<section title="The Neighbor Class list atom">

<t>The Neighbor Class list atom represents a classification of a BGP peering
session.</t>

<t>The minimum Length of the Neighbor Class list atom is 5 octets.  The
Length of this atom must be able to be represented by the relationship 
(Length - 3) % 2 = 0.</t>

</section>

<section title="The User-defined Class atom">
<t>Similar to the Neighbor Class atom, the User-defined Class atom
represents a classification of a network property.  The exact property
definition is up to the semantics of the defining Autonomous System.  The
semantics govening a given User-defined Class list are defined by the Context
AS Number.</t>

<t>Examples of User-defined Class properties include geography (East, West),
continent (North America, Asia, Europe), etc.  Similar to the 
<xref target="RFC1997"/> BGP Communities, it is necessary that the Context AS
provide a registry of the value and the semantics of a given community.</t>

<t>The Length of the User-defined Class atom is exactly 5 octets.</t>
</section>

<section title="The User-defined Class list atom">
<t>The User-defined Class list atom represents a list of User-defined Classes.</t>

<t>The minimum Length of the User-defined Class list atom is 5 octets.  The
Length of this atom must be able to be represented by the relationship 
(Length - 3) % 2 = 0. </t>
</section>

<section title="The UTF-8 String atom">
<t>The UTF-8 String atom represents an arbitrary Unicode string in <xref
target="RFC3629">UTF-8</xref> format.  The Length is required to be of
sufficient size to carry the UTF-8 string in the Value field.</t>

<t>Implementations MUST be prepared for truncated/improperly formed  UTF-8
strings.  When detecting such a string, the implementation should remove
trailing octets of a multi-octet sequence in order to have a well-formed
string.</t>

<t>Implementations MUST be prepared to receive empty (zero-Length) UTF-8 String
atoms as they may be used as Parameters.</t>

</section>

</section>


<section title="Wide BGP Community Attribute">

<t>This document defines a new BGP Path Attribute, the Wide BGP Community.  The
attribute type code is (TBA by IANA).</t>

<t>The Wide BGP Community Attribute is an optional, transitive BGP
attribute, and may be present only once in the
BGP UPDATE message.</t>

<t>The attribute contains a number of typed containers. Any given
container type may appear multiple times, unless that container
type's definition specifies otherwise.</t>

<section title="Wide BGP Community Attribute Container Header">

<figure>
<preamble>Containers always start with the following header:</preamble>
<artwork align='center'>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Type              |     Flags     |   Hop Count   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</artwork>
</figure>
  <texttable title="Flags" anchor='bitdefs'>
    <ttcol align='center'>Bit</ttcol>
    <ttcol align='center'>Value</ttcol>
    <ttcol align='left'>Meaning</ttcol>
    <c>0</c><c>0</c><c>Local community value.</c>
    <c/><c>1</c><c>Registered community value.</c>
    <c>1</c><c>0</c>
        <c>Do not decrement Hop Count field across confederation boundaries.</c>
    <c/><c>1</c>
    	<c>Decrement Hop Count field across confederation boundaries.</c>
    <c>2..7</c><c>-</c>
	<c>SHOULD be zero.</c>
    <postamble>Flags are defined globally, to apply to all wide community container
               types.</postamble>
  </texttable>

<t>Bit 0 set (value 1) indicates that the given container carries a Wide BGP
Community which is registered with IANA. When not set (value 0) it indicates
that community value which follows is locally assigned with a local meaning.
Ignored bits SHOULD be preserved in any received containers, or set to 0
otherwise.</t>

<t>Bit 1 is used to manage the propagation scope of a given Wide BGP Community
across confederation boundaries. When not set (value of 0), the Hop Count field
is not considered at the sub-AS boundaries. When set (value of 1), sub-AS
border router follows the same procedure regarding the handling of the Hop Count
field as applicable to ASBR at the domain boundary.</t>

<t>The Hop Count field represents the forwarding radius, in units of AS
hops, for the given Wide BGP Community.  A Hop Count value of zero indicates
that this wide community must not cross any further AS boundaries.  At each AS
boundary, when propagating a given wide community over an EBGP session, the Hop
Count field MUST be decremented by the sending EBGP speaker.</t>

<t>The exact same decrement procedures described above apply
also to sub-confederation boundaries when the bit 1's flag is set
to 1.</t>

<t>The special value of 0xFF indicates that the enclosed community
may always be propagated over an EBGP boundary. A Hop Count value of 0xFF
MUST NOT be decremented during propagation. </t>

<t>The length represents the total lengths of a given container
in octets.</t>

</section>

</section>

<section title="Container Type 1: Wide Community">

<figure title='Figure 4: Wide BGP Community Type 1'>
<preamble>The Wide BGP Community Type 1 container is of variable size
and is encoded as follows:</preamble>
<artwork align='center'>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Registered/Local Community Value                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Source AS Number                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Context AS Number                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Wide Community Target(s) TLV (optional)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Wide Community Exclude Target(s) TLV (optional)        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Wide Community Parameter(s) TLV (optional)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</artwork>
</figure>

<section title="Community Value">

<t>Community Value: 4 octets</t>

<t><list>
<t>The Wide BGP Community value indicates what set of actions a router is
requested to take upon reception of a route containing this community.  The
semantics of this value depend on whether this is a private/local community
or registered.</t>
</list></t>

</section>

<section title="Source AS Number">

<t>Source Autonomous System Number: 4 octets</t>

<t><list>
<t>The Autonomous System number which indicates the originator of
this Wide BGP Community.</t>

<t> When the Autonomous System is a two octet number the first two
octets of this 4 octet value MUST be filled with zeros.</t>

</list></t>

</section>

<section title="Context AS Number">

<t>Context Autonomous System Number: 4 octets</t>

<t>The Autonomous System number that indicates the context of the
Registered/Local Value.  For Wide Community Containers that are Locally
defined, the Context Autonomous System number provides the context for the
Community Value and thus the meaning of the community as well as any
User-defined Classes for that Context AS.</t>

<t>For Registered Community Containers, the Context Autonomous System number
MAY be utilized to provide specific meaning for that Registered community.
When no such context is implied, this field MUST be 0.</t>

<t>When the wide community is locally registered, the Context Autonomous System
Number indicates the AS that defines the format of this wide community for the
given Local Value.  (In other words, value 1 will likely refer to different
formats for AS 1 vs. AS 2.)</t>

</section>

<section title="Wide Community Target(s) TLV">

<t>The Wide Community Target(s) TLV has the same format as a Wide Community
atom with a Type value of 1.</t>

<t>Wide Community Targets define the matching criteria for the community.
A given wide community may have a number of targets that it applies to.  The
semantics of these targets will vary on a per community basis.  Depending on
the definition of the community, targets may be optional.</t>

<t>The value field of the Wide Community Target(s) TLV is a series of Wide
Community Atom TLVs.  The semantics of any given atom TLV MUST be part of the
definition of a given Wide Community.</t>

<t>Typically, Wide Community Targets consist of a series of atoms that have
"match any" semantics.  Thus, if any given target matches per the semantics of
that atom for the community, the community is considered to match and the
action defined by the community should be executed.</t>

<t>If the semantics of a given atom is undefined for the community in question,
it MUST be ignored.  If an atom with undefined semantics is part of a Grouping
Container, the entire container MUST be ignored.</t>

<t>When no targets are required by the definition of a given Wide Community,
the Wide Community Target(s) TLV SHOULD NOT be encoded in the community.
Implementations MUST be prepared to accept a Wide Community Target(s) TLV with an
empty value field.</t>

</section>

<section title="Wide Community Exclude Target(s) TLV">

<t>The Wide Community Exclude Target(s) TLV has the same format as a Wide
Community with a Type value of 2.</t>

<t>Wide Community Exclude Targets define criteria by which the community is considered to NOT match.
Depending on the semantics of the Wide Community, Exclude Target(s) may be optional.</t>

<t>The semantic of the Wide Community Exclude Target(s) is to match all
specified Target(s) with the exception of those listed in this TLV.  When no
Target(s) TLV is specified, it is considered "match all except these targets".</t>

<t>The value field of the Wide Community Exclude Target(s) TLV is a series of Wide
Community Atom TLVs.  The semantics of any given atom TLV MUST be part of the
definition of a given Wide Community.</t>

<t>If the semantics of a given atom is undefined for the community in question,
it MUST be ignored.  If an atom with undefined semantics is part of a Grouping
Container, the entire container MUST be ignored.</t>

<t>When no exclude targets are required by the definition of a given Wide
Community, the Wide Community Exclude Target(s) TLV SHOULD NOT be encoded in
the community.  Implementations MUST be prepared to accept a Wide Community
Exclude Target(s) TLV with an empty value field.</t>

</section>

<section title="Wide Community Parameter(s) TLV">

<t>The Wide Community Parameter(s) TLV has the same format as a Wide Community
atom with a Type value of 3.</t>

<t>A given wide community may have parameters which are used as inputs for
executing actions defined for that community.  These parameters, and any
constraints implied by the parameters, MUST be defined by the wide community
definition.  Parameters consist of an ordered set of atom sub-TLVs.  The
semantics of any specific positional instance of an atom MUST be defined by the
wide community.</t>

<t>If it is the case that a paramter for a given community is of an unexpected
type, the community MUST be ignored.</t>

<t>If it is the case that there are too many or two few parameters for a given
community, the community MUST be ignored.</t>

<t>When no parameters are required by the definition of a given Wide Community,
the Wide Community Paramters TLV SHOULD NOT be encoded in the community.
Implementations MUST be prepared to accept a Wide Community Parameter TLV with
an empty value field.</t>

</section>

<section title="Usage">

<t> The detailed interpretation of the targets or parameters SHALL be provided
when describing given community type in a separate document or when locally
defined by an operator.</t>

</section>

</section>

<section title="The AS-4 List Generic Wide BGP Community">
<t>In standard <xref target="RFC1997"/> BGP Communities, a commonly deployed
format is AS:AS.  The left-hand-side AS is the context AS while the
right-hand-side represents an action intended to be taken upon that AS.  While
the <xref target="I-D.ietf-idr-as4octet-extcomm-generic-subtype"/>
Extended Community format is intended to address the use cases where the
right-hand-side represents a semi-opaque integer value, operators that desire
to utilize the right-hand-side as an Autonomous System Number have been unable
to do so.</t>

<t>In the AS:AS format, there are no explicit semantics on the action for a
given right-hand-side.  The semantics are implicit to the Autonomous System
number itself.  While such a format doesn't take advantage of the more flexible
semantics of Wide BGP Communities, the format is capable of addressing this
operational need.</t>

<t>This document defines a Registered Wide BGP Community to address that need.</t>

<section title="Definition">
<figure>
<artwork>
  Community Value: 1 - AS-4 List Generic Wide BGP Community
  Source AS Number: &lt;Your AS number&gt;
  Context AS Number: &lt;Targeted AS number&gt;
  Wide Community Target(s): &lt;MUST BE ABSENT&gt;
  Wide Community Exclude Target(s): &lt;MUST BE ABSENT&gt;
  Wide Community Parameter(s):
    &lt;AS Number List&gt;
</artwork>
</figure>


</section>

</section>

<section title="Well Known Standard BGP Communities">

<t>According to RFC 1997, as well as IANA's
Well-Known BGP Communities registry, the following
BGP communities are defined to have global significance: </t>

  <figure>
  <preamble></preamble>
  <artwork>
     0xFFFF0000   planned-shut         [draft-francois-bgp-gshut]
     0xFFFFFF01   NO_EXPORT            [RFC1997]
     0xFFFFFF02   NO_ADVERTISE         [RFC1997]
     0xFFFFFF03   NO_EXPORT_SUBCONFED  [RFC1997]
     0xFFFFFF04   NOPEER               [RFC3765]
  </artwork>
  <postamble></postamble>
  </figure>

<t>This document recommends for simplicity as well as for avoidance of
backward compatibility issues the continued use of BGP Standard Community
Attribute type 8 as defined in RFC 1997 to distribute non Autonomous System
specific Well-Known BGP Communities.</t>

<t>For the same reason, this document does not intended to
obsolete the currently defined and deployed BGP Extended Communities.</t>

</section>

<section title="Operational Considerations">

<t>Having two different ways to propagate locally assigned BGP communities,
one via the use of Standard BGP Communities and the other one via the use of
Wide BGP Communities, may seem to potentially cause problems when considering
propagation of conflicting actions.  However, even at present, an operator may
append Standard BGP Communities with conflicting information.  It is therefore
recommended that any implementation, in supporting both standard and Wide BGP
communities, allow for their easy inbound and outbound processing. The actual
execution of all communities should be treated as a union and, if supported by
an implementation, their execution permissions are to be a local configuration
matter.</t>

</section>

<section title="Error Handling">

<t>If any atom in a Wide Community container's Exclude Targets TLV is
unrecognized, no actions should be taken for that Wide Community.  While the
Targets TLV is meant to be inclusive, the Exclude Targets TLV is meant to be
proscriptive of applying the action.</t>

<t>If any Wide Community container or atoms contained therein are determined to
be malformed, the Wide Community Path attribute must be considered malformed.
BGP implementations should use "treat-as-withdraw" semantics as defined in 
<xref target="I-D.ietf-idr-error-handling"/>.</t>
</section>

<section title="Example">

<section title="Example Wide Community Definition">
<t>An operator, AS 64496, wishes to locally define a Wide Community with the semantics of
permitting AS_PATH prepending with targets that include AS numbers of peer ASes
and peers who have been marked with a set of enumerated city locations.</t>

<t>AS 64496 has established a registered set of values to use for its User-defined Class:<list>
<t>100 - Amsterdam</t>
<t>101 - New York</t>
<t>102 - San Francisco</t>
<t>103 - Tokyo</t>
<t>104 - Moscow</t>
</list></t>

<t>Target semantics:</t>
<t>
<list>
<t>The Autonomous System Number list atom refers to the target peer AS Numbers.</t>
<t>The User-defined Class for AS 64496 has been defined elsewhere and the
values 100..104 may be used for this locally defined Wide Community.</t>
<t>The Targets TLV MUST contain at least one entry.</t>
<t>The Exclude Targets TLV MAY contain entries of the above supported atoms.</t>
<t>The semantics of all other atoms are undefined for this community.</t>
</list>
</t>

<t>Parameter semantics:</t>
<t><list>
<t>The parameter TLV shall consist of exactly one Integer atom value that is
constrained to have a value of 2..8.</t>
</list></t>

</section>

<section title="Example Wide Community Encoding">

<figure>
<preamble></preamble>
<artwork>
  AS_PATH prepend 4 TIMES TO AS 2424, AS 8888, to peers marked as
  Amsterdam (100) or to peers marked Moscow (104), but not to peers 
  in New York (101).

  Use Hop Count 0 to request the receiving router to not propagate
  this wide community.

  Locally community value (flag bit 0 = 0).
  Do not decrement Hop Count field across confederation boundaries
  (0)

  Local community 1 for sample AS 64496.
</artwork>
<postamble></postamble>
</figure>

<figure>
<preamble></preamble>
<artwork align='center'>

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Container Type 1 (1)      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0 0 0 0 0|
+-+-+-+-+-+-+-+-+
| Hop Count: 0  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Length:           57 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Community: LOCAL PREPEND ACTION CATEGORY 1             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Own ASN                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Context ASN# 64496 (0x0000FBF0)                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Target TLV (1)|   Length:                  21 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ASN List (2)  |   Length:                  11 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Target ASN# 2424  (0x00000978)                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Target ASN# 8888  (0x000022B8)                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| User List(14) |   Length:                   7 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Amsterdam             (0x64)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Moscow                (0x68)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|ExcTargetTLV(2)|   Length:                  10 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| User List(14) |   Length:                   7 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| New York              (0x65)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Param TLV (3) |   Length:                  10 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Integer  (13) |   Length:                   7 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Prepend #                                                   4 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</artwork>
<postamble></postamble>
</figure>

</section>

</section>


<section title="Security considerations">

<t>All the security considerations for BGP Communities as well as
for BGP RFCs apply here.</t>

</section>


<section title="IANA Considerations">

<t>This document defines a new BGP Path Attribute called Wide BGP
Community Attribute. For this new type IANA is to allocate a new
value in the corresponding registry:</t>

<t>Registry Name: BGP Path Attributes </t>

<t>This document makes the following assignments for the optional,
transitive Wide BGP Communities Attribute:</t>

<figure>
<artwork>
  Name                                     Type Value
  ----                                     ----------
  Wide BGP Community Attribute                 TBA
</artwork>
</figure>

<t> This document requests IANA to define and maintain a new registry
named: "Wide BGP Communities Attribute Container Types".</t>

<t>The pool of: 0x0000-0xFFFF has been defined for its allocations.
The allocation policy is on a first come, first served basis.</t>


<figure>
<preamble>This document makes the following assignments for the
Wide BGP Communities Container Types values:</preamble>
<artwork>
  Name                             Type Value
  ----                             ----------
  Reserved                           0x0000
  Type 1, Wide BGP Community         0x0001
  Types 2-1023 to be allocated using IETF Consensus
  Types 1024-64511 to be allocated first come, first served
  Types 64512-65534 are reserved for experimental use
  Reserved                           0xFFFF
</artwork>
</figure>

<t>This document requests IANA to define and maintain a new registry
named: "Wide BGP Communities Atom Types".  The pool of 0x0000-0xFFFF has
been defined for its allocations.</t>

<figure>
<preamble>This document makes the following assignments for the
Wide BGP Communities Atom Type values:</preamble>
<artwork>
  Name                             Type Value
  ----                             ----------
  Reserved                           0x00
  Autonomous System Number           0x01
  Autonomous System Number List      0x02
  IPv4 Prefix                        0x03
  IPv4 Prefix list                   0x04
  IPv6 Prefix                        0x05
  IPv6 Prefix list                   0x06
  Integer                            0x07
  Integer list                       0x08
  IEEE Floating Point Number         0x09
  IEEE Floating Point Number list    0x0A
  Neighbor Class                     0x0B
  Neighbor Class list                0x0C
  User-defined Class                 0x0D
  User-defined Class list            0x0E
  UTF-8 string                       0x0F
  Reserved                           0xFF

</artwork>
</figure>

<t>This document requests IANA to define and maintain a new registry
named: "Registered Wide BGP Communities".  The pool of 0x00000000-0FFFFFFFF has
ben defined for its allocation.</t>

<figure>
<preamble>This document makes the following assignments for the Registered Wide
BGP Communities:</preamble>
<artwork>
  Name                                  Type Value
  ----                                  ----------
  Reserved                               0x00
  AS-4 List Generic Wide BGP Community   0x01
  Reserved                               0xFFFFFFFF
  
</artwork>
</figure>

<t>
Values 2-1023 are to be allocated using IETF Consensus.
Values 64512-65534 are reserved for experimental use.
All other values are available on a first-come, first served basis.
</t>

</section>

<section title="Change History">

<t>Changes from -03 to -04:<list>
<t>Substantial re-work of atom types removing proposed Group container.</t>
<t>Added the Exclude Targets TLV to the Wide Community container.</t>
<t>Added a section on error handling.</t>
<t>Updated the example.</t>
</list></t>

<t>Changes from -02 to -03:<list>
<t>Removed C and R named bit fields originally from -00.</t>
<t>Rename Target AS field to Context AS.</t>
<t>Make Integer Atom a fixed 4 octets in length.</t>
<t>Add Neighbor Class Atom</t>
<t>Rename TTL to Hop Count</t>
</list></t>

<t>Changes from -01 to -02:<list>
<t>The Type field has been expanded to 2 octets.</t>
<t>The Length field has been moved to the common header.</t>
<t>Changed format to use TLVs.</t>
<t>Added atom TLV to define well defined syntactic items.</t>
<t>Added TLVs to distinguish targets from parameters.</t>
<t>Various editorial changes to language.</t>
</list></t>

</section>

<section title="Contributors">

<t>The following people contributed significantly to the
content of the document:</t>

<figure>
<preamble></preamble>
<artwork>
Shintaro Kojima
OTEMACHI 1st. SQUARE EAST TOWER, 3F
1-5-1, Otemachi,
Chiyoda-ku, Tokyo 100-0004
Japan
Email: koji@mfeed.ad.jp
</artwork>
<postamble></postamble>
</figure>

<figure>
<preamble></preamble>
<artwork>
Juan Alcaide
Cisco Systems
Research Triangle Park, NC
United States
Email: jalcaide@cisco.com
</artwork>
<postamble></postamble>
</figure>

<figure>
<preamble></preamble>
<artwork>
Burjiz Pithawala
Cisco Systems
170 West Tasman Dr
San Jose, CA
United States
Email: bpithaw@cisco.com
</artwork>
<postamble></postamble>
</figure>

<figure>
<preamble></preamble>
<artwork>
Saku Ytti
TDC Oy
Mechelininkatu 1a
00094 TDC
Finland
Email: ytti@tdc.net
</artwork>
<postamble></postamble>
</figure>

</section>

<section title="Acknowledgments">

<t>This document owes draft-lange-flexible-bgp-communities a debt
for the inspiration of many features contained herein.</t>

<t>The authors would like to thank Enke Chen, Pedro Marques and Alton Lo for
 their valuable input.</t>

</section>

</middle>

<back>
<references title="Normative References">
&RFC2119;
&RFC4271;
&RFC4360;
</references>

<references title="Informative References">
&RFC1997;
&RFC3629;
&RFC4893;
&RFC5668;
&as4octet-generic;
&ieee-float;
&error-handling;

</references>
</back>
</rfc>
